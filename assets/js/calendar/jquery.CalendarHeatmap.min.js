/*
 *  jquery-calendar-heatmap - v1.0.1
 *  A simple Calendar Heatmap for jQuery.
 *  https://github.com/SeBassTian23/CalendarHeatmap
 *
 *  Made by Sebastian Kuhlgert
 *  Under MIT License
 */

!function(b,t,e,s){"use strict";var a="CalendarHeatmap",n={title:null,months:12,weekStartDay:1,lastMonth:moment().month()+1,lastYear:moment().year(),coloring:null,labels:{days:!1,months:!0,custom:{weekDayLabels:null,monthLabels:null}},legend:{show:!0,align:"right",minLabel:"Less",maxLabel:"More"},tooltips:{show:!1,options:{}}};function i(t,e,s){this.element=t,this.data=e,this.settings=b.extend(!0,{},n,s),this._defaults=n,this._name=a,this.init()}b.extend(i.prototype,{init:function(){this.calendarHeatmap(),moment||console.log("The calendar heatmap plugin requires moment.js")},parse:function(){var t=b.type(this.data);if(-1===["array","object"].indexOf(t))return console.log("Invalid data source"),null;if("array"===t&&0<this.data.length){var e=b.type(this.data[0]);if("object"===e)return this.data[0].date&&this.data[0].count?this.data.slice(0):null;if(-1<["string","date"].indexOf(e)){if(moment(this.data[0]).isValid()){var s={};for(var a in this.data){var n=moment(this.data[a]).format("YYYY-MM-DD");s[n]?s[n]+=1:s[n]=1}var i=[];for(var l in s)i.push({count:s[l],date:l});return i}return null}return null}if("array"===t&&0===this.data.length)return[];if("object"!==t||Object.empty(this.data))return null;var h=Object.keys(this.data);if(!moment(h[0]).isValid())return null;if("number"===b.type(this.data[h[0]])){var o=[];for(var d in this.data)o.push({count:this.data[d],date:moment(d).format("YYYY-MM-DD")});return o}},index:function(t){for(var e in this.idx={},t)this.idx[t[e].date]=e},pad:function(t,e){return(t=String(t)).length<e?this.pad("0"+t,e):t},calculateBins:function(t){var e,s=[],a=this.settings.steps||4,n=["0"],i=[[0,0]];for(e in t)t[e].count=parseInt(t[e].count),s.push(t[e].count);var l=Math.min.apply(Math,s),h=Math.max.apply(Math,s),o=(h-l)/a;for(0===o&&(o=h/a)<1&&(o=1),e=0;e<a;e++)if(isFinite(l))if(h<a)0<=e-(a-h)?(n.push(String(e-(a-h)+1)),i.push([e-(a-h)+1,e-(a-h)+1])):(n.push(""),i.push([null,null]));else if(h===a)n.push(String(e+1)),i.push([e+1,e+1]);else if(h-2===a)e+1===a?(n.push(String(e+1)+"+"),i.push([e+1,null])):(n.push(String(e+1)),i.push([e+1,e+1]));else{var d=Math.round(e*o)+1,r=Math.round(e*o+o);i.push([d,r]),e===a-1?d+="+":d!==r&&(d+=" to ",d+=r),n.push(String(d))}else n.push(""),i.push([null,null]);for(e in t)0===t[e].count?t[e].level=0:t[e].count-l==0?t[e].level=1:isFinite(l)?t[e].level=this.matchBin(i,t[e].count):t[e].level=a;return{events:t,bins:n}},matchBin:function(t,e){for(var s in t)if(e>=t[s][0]&&e<=t[s][1])return s;return 0},matchDate:function(t,e){return this.idx[e]?t[this.idx[e]]:null},addWeekColumn:function(){if(this.settings.labels.days){b(".ch-year",this.element).append('<div class="ch-week-labels"></div>'),b(".ch-week-labels",this.element).append('<div class="ch-week-label-col"></div>'),b(".ch-week-label-col",this.element).append('<div class="ch-day-labels"></div>'),this.settings.labels.months&&b(".ch-week-labels",this.element).append('<div class="ch-month-label">&nbsp;</div>');for(var t=this.settings.weekStartDay||1,e=0;e<7;e++){var s=moment().weekday(e+t).format("ddd"),a=moment().weekday(e+t).format("d");if((e-1)%2){var n=this.settings.labels.custom.weekDayLabels;"array"===b.type(n)?s=n[a]||"":"string"===b.type(n)&&(s=moment().weekday(e+t).format(n))}else s="&nbsp;";b("<div>",{class:"ch-day-label",html:s}).appendTo(b(".ch-day-labels",this.element))}}},calendarHeatmap:function(){var t=this.parse();if("array"===b.type(t)){this.index(t);var e,s=this.calculateBins(t),a=s.events,n=s.bins,i=this.settings.lastMonth,l=this.settings.lastYear,h=this.settings.months,o=this.settings.weekStartDay||1;for(b(this.element).empty(),this.settings.title&&b("<h3>",{class:"ch-title",html:this.settings.title}).appendTo(b(this.element)),b(this.element).addClass("ch").append('<div class="ch-year"></div>'),this.addWeekColumn(),e=h;0<e;e--){var d=i-e,r=l;d<0&&(r-=1,d+=12);var c=moment().set({month:d,year:r}).format("MMM");this.settings.labels.custom.monthLabels&&(c="array"===b.type(this.settings.labels.custom.monthLabels)?this.settings.labels.custom.monthLabels[d]||"":moment().set({month:d,year:r}).format(this.settings.labels.custom.monthLabels)),b(".ch-year",this.element).append('<div class="ch-month"></div>'),b(".ch-month:last",this.element).append('<div class="ch-weeks"></div>'),this.settings.labels.months&&b(".ch-month:last",this.element).append('<div class="ch-month-label">'+c+"</div>");var m=moment().set({month:d,year:r}).daysInMonth();b(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week"></div>');for(var p=0,u=0;u<m;u++){var g=r+"-"+this.pad(d+1,2);g+="-"+this.pad(u+1,2);var v=this.matchDate(a,g);if(v){var f=v.count+" on ";f+=moment(v.date).format("ll");var y="";this.settings.coloring&&(y=" "+this.settings.coloring+"-"+v.level),b("<div/>",{class:"ch-day lvl-"+v.level+y,title:f,"data-toggle":"tooltip"}).appendTo(b(".ch-month:last .ch-weeks .ch-week:last",this.element))}else b("<div/>",{class:"ch-day"}).appendTo(b(".ch-month:last .ch-weeks .ch-week:last",this.element));p++,moment().set({date:u+2,month:d,year:r}).isoWeekday()===o&&u<m-1&&(b(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week">'+u+"</div>"),p=0)}for(;p<7;p++)b(".ch-month:last .ch-weeks .ch-week:last",this.element).append('<div class="ch-day is-outside-month"></div>')}if(this.settings.legend.show)for(b("<div>",{class:"ch-legend"}).appendTo(this.element).append("<small>"+(this.settings.legend.minLabel||"")+"</small>").append('<ul class="ch-lvls"></ul>').append("<small>"+(this.settings.legend.maxLabel||"")+"</small>"),"left"===this.settings.legend.align&&b(".ch-legend",this.element).addClass("ch-legend-left"),"center"===this.settings.legend.align&&b(".ch-legend",this.element).addClass("ch-legend-center"),e=0;e<n.length;e++)b("<li>",{class:"ch-lvl lvl-"+e,title:n[e],"data-toggle":"tooltip"}).appendTo(b(".ch-lvls",this.element)),this.settings.coloring&&b(".ch-lvls li:last",this.element).addClass(this.settings.coloring+"-"+e);this.settings.tooltips.show&&"function"==typeof b.fn.tooltip&&b('[data-toggle="tooltip"]',this.element).tooltip(this.settings.tooltips.options)}}}),b.fn[a]=function(t,e){return this.each(function(){b.data(this,"plugin_"+a)||b.data(this,"plugin_"+a,new i(this,t,e))})}}(jQuery,window,document);